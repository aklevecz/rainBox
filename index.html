
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js webgl - postprocessing backgrounds</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				margin: 0px;
				background-color: #000;
				overflow: hidden;
				font-family:Monospace;
				font-size:13px;
				margin: 0px;
				text-align:center;
				overflow: hidden;
			}

			a { color: #88f; }

			#info {
				color: #fff;
				position: absolute;
				top: 10px;
				width: 100%;
				text-align: center;
				display:block;
			}
		</style>
	</head>
	<body>
		<div id="container"></div>
		<video id="video" src="trippyrain.mp4" loop style="display:none"></video>
		<script src="build/three.js"></script>
		<script src="js/libs/stats.min.js"></script>
		<script src="js/libs/dat.gui.min.js"></script>

		<script src="js/shaders/CopyShader.js"></script>

		<script src="js/postprocessing/EffectComposer.js"></script>
		<script src="js/postprocessing/ClearPass.js"></script>
		<script src="js/postprocessing/RenderPass.js"></script>
		<script src="js/postprocessing/TexturePass.js"></script>
		<script src="js/postprocessing/CubeTexturePass.js"></script>
		<script src="js/postprocessing/ShaderPass.js"></script>
		<script src="js/THREEx.KeyboardState.js"></script>
<script src="js/THREEx.FullScreen.js"></script>
<script src="js/THREEx.WindowResize.js"></script>

		<script src="js/OrbitControls.js"></script>
		<script src="js/FirstPersonControls.js"></script>

		<script src="js/virtualjoystick.js"></script>
<script src="js/touch-fps-controls.js"></script>

<button id="test" 
	style="user-select:none;position: absolute;background-color:red;margin:50px;"
	>CHICKEN ASS</button>

	<button id="test2" 
	style="user-select:none;position: absolute;background-color:red;margin:80px;"
	>CHICKEN ASS</button>


		<div id="ThreeJS" style="position: absolute; left:0px; top:0px"></div>

		<script>
		function getRandomInt(min, max) {
							min = Math.ceil(min);
							max = Math.floor(max);
							return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
						}
		function makeBoxLand(){
			var geometry = new THREE.BoxGeometry( 100, 100, 100 );
				
				
				for ( var i = 0; i < 1000; i ++ ) {

					var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff, opacity: .4, transparent:true } ) );
					// object.position.x = getRandomInt(-250000,250000);
					// object.position.y = getRandomInt(-250000,250000);
					// object.position.z = getRandomInt(-250000,250000);
					object.data = {x:getRandomInt(-250000,250000),
								   y:getRandomInt(-250000,250000),
								   z:getRandomInt(-250000,250000)};

					

					
					object.scale.x = Math.random() * 20 + 1;
					object.scale.y = Math.random() * 20 + 1;
					object.scale.z = Math.random() * 20 + 1;

					object.rotation.x = Math.random() * 2 * Math.PI;
					object.rotation.y = Math.random() * 2 * Math.PI;
					object.rotation.z = Math.random() * 2 * Math.PI;

					scene.add( object );

					objects.push( object );

				}
		}
			var clock = new THREE.Clock();
			var camControls;
			var container, stats;
			var camera, scene, renderer;
            var particleMaterial;
			var controls;
			
			var switcher;

			var raycaster;
			var mouse;

			var objects = [];
			var portal;
			var phase = 1;

			var vidTexture

			init();
			animate();

			function init() {

				

				container = document.createElement( 'div' );
				document.body.appendChild( container );


				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000000 );
				// position and point the camera to the center of the scene
				camera.position.x = 100;
				camera.position.y = 10;
				camera.position.z = -10000;
				camera.lookAt(new THREE.Vector3(0, 0, 0));


				camControls = new THREE.FirstPersonControls(camera);
				camControls.lookSpeed = 0.4;
				camControls.movementSpeed = 20000;
				camControls.noFly = true;
				camControls.lookVertical = true;
				camControls.constrainVertical = true;
				camControls.verticalMin = 1.0;
				camControls.verticalMax = 2.0;
				camControls.lon = -150;
				camControls.lat = 120;
		


			document.getElementById('test').addEventListener("mousedown", function(){
				camControls.activeLook = false;
				camControls.moveForward = true;
			})

			document.getElementById('test2').addEventListener("mousedown", function(){
				camControls.activeLook = true;
				camControls.moveForward = false;
			})
				scene = new THREE.Scene();



				//scene.background = new THREE.Color( 0x000000 );
				console.log(scene);
				// var geometry = new THREE.BoxGeometry( 100, 100, 100 );
				
				
				// for ( var i = 0; i < 1000; i ++ ) {

				// 	var object = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff, opacity: 0.5 } ) );
				// 	object.position.x = getRandomInt(-250000,250000);
				// 	object.position.y = getRandomInt(-250000,250000);
				// 	object.position.z = getRandomInt(-250000,250000);

				// 	object.scale.x = Math.random() * 20 + 1;
				// 	object.scale.y = Math.random() * 20 + 1;
				// 	object.scale.z = Math.random() * 20 + 1;

				// 	object.rotation.x = Math.random() * 2 * Math.PI;
				// 	object.rotation.y = Math.random() * 2 * Math.PI;
				// 	object.rotation.z = Math.random() * 2 * Math.PI;

				// 	scene.add( object );

				// 	objects.push( object );

				// }
					var geometry = new THREE.BoxGeometry(500,500,500)
					var material = new THREE.MeshBasicMaterial({color:"green", opacity:.3});
					switcher = new THREE.Mesh(geometry, material);
					switcher.name = "switch";
					switcher.data = {x:0,y:0,z:0};
					objects.push(switcher);
					scene.add(switcher);
					switcher.material.transparent = true;
					var geometry = new THREE.BoxGeometry( 100000, 100000, 10 );

					portal = new THREE.Mesh( geometry, new THREE.MeshBasicMaterial( { color: "red" } ) );
					portal.position.z = -249000;
					scene.add(portal);

				var imagePrefix = "images/dawnmountain-";
				var directions = ["xpos", "xneg", "ypos", "yneg", "zpos", "zneg"];
				var imageSuffix = ".png";

				var skyGeometry = new THREE.CubeGeometry(500000,500000,500000);

				var material_array = [];

				var video = document.getElementById('video');
				video.play();
				document.body.addEventListener('click', function(){
					video.play();
				}, false);
				vidTexture = new THREE.VideoTexture( video );
				vidTexture.minFilter = THREE.LinearFilter;
				vidTexture.magFilter = THREE.LinearFilter;
				for (var i=0; i < 6 ; i++){
					console.log('meepo')
					material_array.push( new THREE.MeshBasicMaterial({
						 //map: new THREE.TextureLoader().load(imagePrefix + directions[i] + imageSuffix),
							map: vidTexture,
						side: THREE.BackSide,
					}));
				}

				var skyMaterial = new THREE.MeshFaceMaterial( material_array );
				var skyBox = new THREE.Mesh( skyGeometry, skyMaterial );
				scene.add(skyBox);

				// var PI2 = Math.PI * 2;
				// particleMaterial = new THREE.SpriteCanvasMaterial( {

				// 	color: 0xFFFFFF,
				// 	program: function ( context ) {

				// 		context.beginPath();
				// 		context.arc( 0, 0, 0.5, 0, PI2, true );
				// 		context.fill();

				// 	}

				// } );

				//

				raycaster = new THREE.Raycaster();
				mouse = new THREE.Vector2();

				renderer = new THREE.WebGLRenderer({ alpha: true } );
				//renderer.setClearColor(new THREE.Color(0x000, 1.0));
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
			
				stats = new Stats();
				container.appendChild( stats.dom );

				document.addEventListener( 'mousedown', onDocumentMouseDown, false );
				document.addEventListener( 'touchstart', onDocumentTouchStart, false );

				//

				window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentTouchStart( event ) {

				event.preventDefault();

				event.clientX = event.touches[0].clientX;
				event.clientY = event.touches[0].clientY;
				onDocumentMouseDown( event );

			}

			function onDocumentMouseDown( event ) {

				event.preventDefault();

				mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;

				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( objects );

				
				
				var distance = raycaster.ray.origin.distanceTo( intersects[0].point );
				

				if ( intersects.length > 0 && distance < 20000 ) {
					phase = 2;
					if (intersects[0].object.name==="switch") makeBoxLand();

					intersects[ 0 ].object.material.color.setHex( Math.random() * 0xffffff );

				}
			}

			//

			function animate() {
				var delta = clock.getDelta();
				requestAnimationFrame( animate );

				render();
				stats.update();

                camControls.update(delta);


			}

			var radius = 600;
			var theta = 0;

			function render() {

				theta += 0.1;
				var time = clock.elapsedTime;
				vidTexture.needsUpdate = true;
				

				
				
				for (var i = 0; i < objects.length ; i++){
					var {x,y,z} = objects[i].data;
					
					
					if (x>0){
						if (x > objects[i].position.x){
							objects[i].position.x+=100
						}
					} else {
						if (x < objects[i].position.x){
							objects[i].position.x-=100
						}
					}
					
					if (y>0){
						if (y > objects[i].position.y){
							objects[i].position.y+=100
						}
					} else {
						if (y < objects[i].position.y){
							objects[i].position.y-=100
						}
					}

					if (z > 0) {
						if (z > objects[i].position.z){
							objects[i].position.z+=100
						}
					} else{
						if (z < objects[i].position.z){
							objects[i].position.z-=100
						}
					}

					objects[i].rotation.y += Math.sin(Math.random()/20);
					objects[i].rotation.x += Math.cos(Math.random())/200;
				}

				//phase 1
				//console.log(camera.position);
				var p = camera.position;
				
				if (phase<3){
					if (camera.position.z <= -250000 && phase===2){
						phase = 3;
					} else {

						if (phase===2){
							if (camera.position.z < -249914 &&
								(
									(p.x > 50000 || p.x < -50000) || 
									(p.y > 50000 || p.y < -50000))
								
							   ) {
									console.log('blocked')
								camera.position.z = -249914;
							}
						} else {
							if (camera.position.z < -249914) {
									console.log('blocked')
								camera.position.z = -249914;
							}
						}



							if(camera.position.z > 249914) {
								camera.position.z = 249914;
							}
							if (camera.position.x < -249914) {
								camera.position.x = -249914;
							}
							if(camera.position.x > 249914) {
								camera.position.x = 249914;
							}
							if (camera.position.y < -249914) {
								camera.position.y = -249914;
							}
							if(camera.position.y > 249914) {
								camera.position.y = 249914;
							}
				}
			}

				//phase 2
				if (phase===2){
				portal.material.color=new THREE.Vector3(0,0,Math.sin(time));
				portal.scale.x=Math.sin(time);
				
			}
				renderer.render(scene, camera);

			}

		</script>
	
	</body>
</html>
